{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-pencil-square"></i> Edit Jump Point</h2>
        <a href="/main" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Map
        </a>
    </div>

    {% if obj.errors | length > 0 %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill"></i> <strong>Please fix the following errors:</strong>
        <ul class="mb-0 mt-2">
            {% for error in obj.errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-body">
            <form action="manage?action=update&pkval={{ obj.data[0][obj.pk] }}" method="POST">
                <!-- Hidden field for location_id -->
                <input type="hidden" name="location_id" value="{{ obj.data[0].location_id }}">

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="name" class="form-label">Jump Point Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ obj.data[0].name }}" required>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="height_feet" class="form-label">Height (feet)</label>
                        <input type="number" class="form-control" id="height_feet" name="height_feet" value="{{ obj.data[0].height_feet }}" step="0.1" min="0">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="difficulty" class="form-label">Difficulty</label>
                        <select class="form-select" id="difficulty" name="difficulty">
                            <option value="">-- Select --</option>
                            {% for level in obj.difficulty_levels %}
                                <option value="{{ level.value }}" {% if obj.data[0].difficulty == level.value %}selected{% endif %}>
                                    {{ level.text }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="position_description" class="form-label">Position Description</label>
                    <input type="text" class="form-control" id="position_description" name="position_description" value="{{ obj.data[0].position_description }}">
                    <div class="form-text">Where is this jump point located within the area?</div>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="3">{{ obj.data[0].description }}</textarea>
                </div>

                <div class="mb-3">
                    <label for="dangers" class="form-label">Dangers/Warnings</label>
                    <textarea class="form-control" id="dangers" name="dangers" rows="2">{{ obj.data[0].dangers }}</textarea>
                </div>

                <div class="row mb-3">
                    <div class="col-md-3">
                        <label class="form-label">Submitted By</label>
                        <p class="form-control-plaintext">User ID {{ obj.data[0].submitted_by }}</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Created Date</label>
                        <p class="form-control-plaintext">{{ obj.data[0].submission_timestamp }}</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Verified</label>
                        <p class="form-control-plaintext">
                            {% if obj.data[0].verified %}
                                <span class="badge bg-success"><i class="bi bi-check-circle"></i> Yes</span>
                            {% else %}
                                <span class="badge bg-warning"><i class="bi bi-hourglass"></i> No</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <p class="form-control-plaintext">
                            {% if obj.data[0].status == 'active' %}
                                <span class="badge bg-success"><i class="bi bi-check-circle"></i> Active</span>
                            {% elif obj.data[0].status == 'closed' %}
                                <span class="badge bg-secondary"><i class="bi bi-x-circle"></i> Closed</span>
                            {% elif obj.data[0].status == 'dangerous' %}
                                <span class="badge bg-danger"><i class="bi bi-exclamation-triangle"></i> Dangerous</span>
                            {% endif %}
                        </p>
                    </div>
                </div>

                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-save"></i> Update Jump Point
                    </button>
                    <a href="/jumppoints/manage?pkval={{ obj.data[0][obj.pk] }}&action=delete"
                       class="btn btn-danger"
                       onclick="return confirm('Are you sure you want to delete this jump point? This action cannot be undone.')">
                        <i class="bi bi-trash"></i> Delete Jump Point
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
